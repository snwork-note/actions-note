name: Post to Note.com

on:
  workflow_dispatch:

jobs:
  post:
    runs-on: ubuntu-latest

    env:
      NOTE_STORAGE_STATE_JSON: ${{ secrets.NOTE_STORAGE_STATE_JSON }}
      THEME: GitHub Actions と note 自動化
      TARGET: 副業を探してる人
      MESSAGE: 面倒なところを自動化
      CTA: 実際に workflow を作ってみよう
      TAGS: 副業,AI,アフィリエイト
      IS_PUBLIC: false
      DRY_RUN: false

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: 🧩 Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: 📦 Install dependencies
        run: npm install playwright

      - name: 🎭 Install Playwright browsers
        run: npx playwright install --with-deps chromium

      - name: 🚀 Run post script
        id: post
        run: |
          echo "🟢 note.com にアクセス開始..."
          node post.mjs
        continue-on-error: true  # ← 失敗しても次のステップに進む

      - name: 🧾 Upload screenshots (if exist)
        if: always()  # ← 成功・失敗を問わず実行
        uses: actions/upload-artifact@v4
        with:
          name: note-debug-screenshots
          path: |
            title_error.png
            body_error.png
            save_error.png
            fatal_error.png
          if-no-files-found: ignore
