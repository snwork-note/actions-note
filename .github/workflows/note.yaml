name: Post to Note.com

on:
  workflow_dispatch:

jobs:
  post:
    runs-on: ubuntu-latest

    env:
      NOTE_STORAGE_STATE_JSON: ${{ secrets.NOTE_STORAGE_STATE_JSON }}
      THEME: GitHub Actions ã¨ note è‡ªå‹•åŒ–
      TARGET: å‰¯æ¥­ã‚’æ¢ã—ã¦ã‚‹äºº
      MESSAGE: é¢å€’ãªã¨ã“ã‚ã‚’è‡ªå‹•åŒ–
      CTA: å®Ÿéš›ã« workflow ã‚’ä½œã£ã¦ã¿ã‚ˆã†
      TAGS: å‰¯æ¥­,AI,ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ
      IS_PUBLIC: false
      DRY_RUN: false

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ§© Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: ğŸ“¦ Install dependencies
        run: npm install playwright

      - name: ğŸ­ Install Playwright browsers
        run: npx playwright install --with-deps chromium

      - name: ğŸš€ Run post script
        id: post
        run: |
          echo "ğŸŸ¢ note.com ã«ã‚¢ã‚¯ã‚»ã‚¹é–‹å§‹..."
          node post.mjs
        continue-on-error: true  # â† å¤±æ•—ã—ã¦ã‚‚æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã‚€

      - name: ğŸ§¾ Upload screenshots (if exist)
        if: always()  # â† æˆåŠŸãƒ»å¤±æ•—ã‚’å•ã‚ãšå®Ÿè¡Œ
        uses: actions/upload-artifact@v4
        with:
          name: note-debug-screenshots
          path: |
            title_error.png
            body_error.png
            save_error.png
            fatal_error.png
          if-no-files-found: ignore
