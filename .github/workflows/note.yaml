name: Note Auto Post

on:
  workflow_dispatch:
    inputs:
      theme:
        description: "æŠ•ç¨¿ãƒ†ãƒ¼ãƒ"
        required: true
      target:
        description: "å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼"
        required: true
      message:
        description: "æŠ•ç¨¿æœ¬æ–‡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"
        required: true
      cta:
        description: "CTAï¼ˆè¡Œå‹•å–šèµ·æ–‡ï¼‰"
        required: true
      tags:
        description: "ã‚¿ã‚°ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰"
        required: false
      is_public:
        description: "å…¬é–‹è¨­å®šï¼ˆtrue = å…¬é–‹, false = éå…¬é–‹ï¼‰"
        required: true
      dry_run:
        description: "ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ãƒ¢ãƒ¼ãƒ‰ï¼ˆtrue = æŠ•ç¨¿ã—ãªã„ï¼‰"
        required: true

jobs:
  post:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ğŸ§° Node.js ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: ğŸ“¦ ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: npm ci

      - name: ğŸ§­ Playwright ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          npx playwright install --with-deps
          echo "âœ… Playwright browsers installed successfully"

      - name: ğŸš€ Note ã«è‡ªå‹•æŠ•ç¨¿
        env:
          NOTE_STORAGE_STATE_JSON: ${{ secrets.NOTE_STORAGE_STATE_JSON }}
          THEME: ${{ github.event.inputs.theme }}
          TARGET: ${{ github.event.inputs.target }}
          MESSAGE: ${{ github.event.inputs.message }}
          CTA: ${{ github.event.inputs.cta }}
          TAGS: ${{ github.event.inputs.tags }}
          IS_PUBLIC: ${{ github.event.inputs.is_public }}
          DRY_RUN: ${{ github.event.inputs.dry_run }}
        run: |
          echo "Starting Note auto-post workflow..."
          node post.mjs
